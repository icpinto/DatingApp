# Dating App Backend

This repository contains the Go backend for a dating application. It exposes a REST API for
user registration, authentication, profile management, matchmaking, and friend request
flows. The service also integrates with external matchmaking and messaging
services and exposes autogenerated Swagger documentation.

## Features

- REST API built with [Gin](https://gin-gonic.com/)
- PostgreSQL persistence layer with centralized connection handling
- Profile verification workflow using JWT-signed verification tokens
- Background outbox worker for delivering messages to the messaging service
- Swagger UI available at `/swagger/index.html`

## Prerequisites

- [Go](https://go.dev/) **1.23** or newer (toolchain `go1.24.3`)
- Optional: Docker and Docker Compose for containerized development (the provided
  Compose file starts both the API and a PostgreSQL instance)

## Getting Started

1. **Clone the repository**
   ```bash
   git clone https://github.com/icpinto/dating-app.git
   cd dating-app
   ```

2. **Configure environment variables**
   - Copy the provided `.env` file and adjust the values as needed for your environment.
   - Ensure the database connection string and external service URLs are reachable from
     the application. The Docker Compose setup injects a working `DATABASE_URL`
     that points at the bundled PostgreSQL service.

3. **Install dependencies** (Go modules are automatically restored when you build or run):
   ```bash
   go mod download
   ```

4. **Run database migrations** (if you manage the database manually). When using the
   provided Docker Compose stack, all SQL migrations under `internals/db/migrations`
   are executed automatically during the first PostgreSQL container startup.

5. **Start the application locally**:
   ```bash
   go run ./cmd/app
   ```
   The API listens on `http://localhost:8080` by default.

6. **Access API documentation**:
   Navigate to `http://localhost:8080/swagger/index.html` to explore the Swagger UI.

## Docker Compose

A `docker-compose.yml` file is provided for convenience. It provisions both the API
container and a PostgreSQL database. A lightweight bootstrap container now ensures that
the `datingdb` database exists (even if the Postgres volume was previously initialized)
and runs the SQL files in `internals/db/migrations` the first time the schema is needed.
Make sure the `dating-shared-net` Docker network
exists (it is referenced as an external network). Then start the service:

```bash
docker network create dating-shared-net  # run once if the network does not yet exist
docker compose up --build
```

## Environment Variables

The application reads its configuration from environment variables. The `.env` file in the
project root documents the supported variables:

| Variable | Description |
| --- | --- |
| `DATABASE_URL` | PostgreSQL connection string used by the application. |
| `MATCH_SERVICE_URL` | Base URL of the external match service. |
| `MESSAGING_SERVICE_URL` | Base URL of the messaging/outbox relay service. |
| `CONTACT_VERIFICATION_JWT_SECRET` | Secret for verifying contact verification tokens. |
| `IDENTITY_VERIFICATION_JWT_SECRET` | Secret for verifying identity verification tokens. |
| `VERIFICATION_JWT_SECRET` | Optional fallback secret for verification tokens. |
| `JWT_SECRET` | Optional fallback secret for general JWT validation. |

The service provides sensible defaults for some variables, but configuring them explicitly
is recommended for production deployments.

## Testing

Run unit tests with:

```bash
go test ./...
```

## Folder Structure

- `cmd/app`: Application entry point and router wiring
- `controllers`: HTTP handlers for API endpoints
- `internals/db`: Database connection utilities
- `middlewares`: Gin middlewares for authentication and service injection
- `services`: Core business logic and integrations (matchmaking, profiles)
- `models`: Data models and persistence helpers
- `repositories`: Data access layer
- `docs`: Swagger documentation artifacts

## License

This project is provided as-is. Refer to the repository or project owner for licensing details.
